{% extends 'include/base/homepage.html' %}
{% load static %}
{% block content %}
  <!--[if lt IE 8]>
		<p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
	<![endif]-->

  {% include 'include/base/secondary/header.html' %}

  <div class="cover-page">
    <div class="cover-bg">
      <img class="fit" src="{% static 'img/bg-default1.jpg' %}" alt="cover">
    </div>
    <div class="cover-bg bg-black opacity-8"></div>
  </div>

  <!-- BEGIN OF page main content -->
  <main class="page-main sections-scroll scroll-anim" id="mainpage">
    <section id="reviews-form" class="section section-a fullscreen-h-lg">
      <div class="section-title title-anim">
        <div data-anim-visible='zoom-in'>
          <h2 class="text">Оставить отзыв</h2>
        </div>
      </div>
      <div class="section-body">
        <div class="section-content container content-width anim">
          <div class="row justify-content-between">
            <div class="col-12 col-lg-6 text-left">
              <div class="title-desc pe-lg-5" data-anim-visible='fade'>
                <h2 class="display-3 anim-1 mb-4">Поделитесь впечатлениями</h2>
                <p class="anim-2">Ваше мнение помогает нам становиться лучше. Заполните форму ниже — публикация после модерации.</p>
              </div>
            </div>

            <div class="col-12 col-lg-5 text-left d-flex justify-content-lg-end" data-anim-visible='fade'>
              {% if messages %}
              <div class="mb-3">
                {% for message in messages %}
                  <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %}" role="alert">
                    {{ message }}
                  </div>
                {% endfor %}
              </div>
              {% endif %}

              <style>
                /* Fancy glass card with gradient border & glow */
                .glass-card { position: relative; background: rgba(18,18,18,.45); border: 1px solid rgba(255,255,255,.1); box-shadow: 0 20px 50px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06); backdrop-filter: blur(12px); border-radius: 18px; overflow: hidden; }
                .glass-card:before { content: ""; position: absolute; inset: -2px; border-radius: 20px; padding: 2px; background: conic-gradient(from 180deg at 50% 50%, rgba(255,255,255,.25), rgba(255,255,255,0) 30%, rgba(255,255,255,.25) 60%, rgba(255,255,255,0) 90%); -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none; }
                .glass-card:after { content: ""; position: absolute; inset: -20% -40%; background: radial-gradient(40% 40% at 20% 20%, rgba(255,255,255,.08), transparent 60%), radial-gradient(40% 40% at 80% 80%, rgba(255,255,255,.06), transparent 60%); filter: blur(20px); pointer-events: none; }
                .glass-card:hover { box-shadow: 0 25px 60px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.06) inset; transform: translateY(-2px); transition: .25s ease; }
                .form-floating-a { position: relative; }
                .form-floating-a .form-control-a, .form-floating-a .form-control { background: transparent; color: #fff; border: 0; box-shadow: none; outline: none; position: relative; z-index: 1; }
                .form-floating-a label { position: absolute; left: 44px; top: 50%; transform: translateY(-50%); opacity: .65; transition: .2s ease; pointer-events: none; z-index: 0; }
                .form-floating-a .form-control:focus + label, .form-floating-a .form-control:not(:placeholder-shown) + label,
                .form-floating-a .form-control-a:focus + label, .form-floating-a .form-control-a:not(:placeholder-shown) + label,
                .form-floating-a .form-control.is-filled + label, .form-floating-a .form-control-a.is-filled + label,
                .form-floating-a .form-control:-webkit-autofill + label, .form-floating-a .form-control-a:-webkit-autofill + label { top: -12px; transform: translateY(-180%); font-size: .72rem; opacity: .2; }
                .form-floating-a .form-control:focus + label, .form-floating-a .form-control-a:focus + label { opacity: 0; }
                /* Ensure label moves when wrapper is focused or has value */
                .form-floating-a:focus-within label { top: -14px; transform: translateY(-220%); font-size: .72rem; opacity: 0; visibility: hidden; }
                .form-floating-a.has-value label { top: -14px; transform: translateY(-220%); font-size: .72rem; opacity: 0; visibility: hidden; }
                .input-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); opacity: .85; }
                .underline { height: 2px; background: linear-gradient(90deg, rgba(255,255,255,.25), rgba(255,255,255,.05)); margin-top: 2px; overflow: hidden; }
                .underline > i { display:block; height:2px; width:0; background: linear-gradient(90deg, #fff, rgba(255,255,255,.3)); transition: width .35s ease; }
                .form-floating-a .form-control:focus ~ .underline > i,
                .form-floating-a .form-control-a:focus ~ .underline > i { width:100%; }
                .char-hint { font-size: .85rem; opacity: .7; }
                .form-title { font-weight: 700; letter-spacing: .3px; }
                .note { font-size: .9rem; opacity:.75; }

                /* Accent gradient and glow */
                :root { --accent1: #ff4d67; --accent2: #ff9a9e; }
                .btn-accent { background: linear-gradient(135deg, var(--accent1), var(--accent2)); color:#111; border: 0; box-shadow: 0 8px 24px rgba(255,77,103,.35); }
                .btn-accent:hover { filter: brightness(1.05); box-shadow: 0 10px 28px rgba(255,77,103,.45); }
                .btn-outline-white-soft { border:1px solid rgba(255,255,255,.35); color:#fff; }
                .btn-outline-white-soft:hover { background: rgba(255,255,255,.08); }

                /* Big watermark */
                .wm-wrap { position: relative; }
                .wm-wrap .watermark { position: absolute; right: -10px; top: -30px; font-weight: 800; font-size: 90px; letter-spacing: .06em; color: rgba(255,255,255,.06); pointer-events: none; user-select: none; }
                @media (max-width: 992px) { .wm-wrap .watermark { display:none; } }
              </style>

              <div class="wm-wrap position-relative">
                <div class="watermark">REVIEW</div>
              </div>
              <form id="form-review" class="form-a p-4 p-lg-5 glass-card" style="min-width: 380px; max-width: 520px;" method="post" action="{% url 'review_submit' %}">
                {% csrf_token %}
                <div class="mb-3">
                  <h4 class="form-title mb-1">Оставьте отзыв</h4>
                  <p class="note mb-0">Нам важно ваше мнение</p>
                </div>
                <div class="mb-3 form-floating-a">
                  <span class="input-icon"><i class="ion ion-md-person"></i></span>
                  <input type="text" class="form-control form-control-a ps-5" id="review-name" name="name" placeholder=" " required>
                  <label for="review-name">Имя</label>
                  <div class="underline"><i></i></div>
                </div>
                <div class="mb-2 form-floating-a">
                  <span class="input-icon"><i class="ion ion-md-create"></i></span>
                  <textarea class="form-control form-control-a ps-5" id="review-text" name="review_text" rows="5" placeholder=" " maxlength="600" required></textarea>
                  <label for="review-text">Ваш отзыв</label>
                  <div class="underline"><i></i></div>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <small class="char-hint"><span id="rev-count">0</span>/600</small>
                  <small class="char-hint">Публикация после модерации</small>
                </div>
                <div class="mt-3 d-flex gap-2">
                  <button type="submit" class="btn btn-accent rounded-pill px-4">
                    <span class="text">Отправить</span>
                  </button>
                  <a href="/" class="btn btn-outline-white-soft rounded-pill px-4">
                    <span class="text">На главную</span>
                  </a>
                </div>
              </form>

              <script>
                (function(){
                  var nameI = document.getElementById('review-name');
                  var textA = document.getElementById('review-text');
                  if(!nameI || !textA) return;

                  // Floating labels: mark filled
                  function syncFilled(el){
                    var wrap = el.closest('.form-floating-a');
                    var has = (el.value||'').trim().length > 0;
                    el.classList.toggle('is-filled', has);
                    if (wrap) wrap.classList.toggle('has-value', has);
                  }
                  ['input','change','blur'].forEach(function(evt){
                    nameI.addEventListener(evt, function(){ syncFilled(nameI); });
                    textA.addEventListener(evt, function(){ syncFilled(textA); });
                  });
                  // Also set focus state on wrapper for safety (not required for :focus-within but helps old browsers)
                  ;[nameI, textA].forEach(function(el){
                    var wrap = el.closest('.form-floating-a');
                    if(!wrap) return;
                    el.addEventListener('focus', function(){ wrap.classList.add('is-focused'); });
                    el.addEventListener('blur', function(){ wrap.classList.remove('is-focused'); });
                  });
                  // On load (incl. autofill)
                  setTimeout(function(){ syncFilled(nameI); syncFilled(textA); }, 50);

                  // Char counter
                  var counter = document.getElementById('rev-count');
                  function updCount(){ counter.textContent = (textA.value||'').length; }
                  textA.addEventListener('input', updCount); updCount();

                  // Auto-resize textarea
                  function autoSize(){ this.style.height = 'auto'; this.style.height = (this.scrollHeight+2) + 'px'; }
                  ['input','focus'].forEach(function(evt){ textA.addEventListener(evt, autoSize); });
                  autoSize.call(textA);
                })();
              </script>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  {% include 'include/base/footer.html' %}

  {% endblock %}